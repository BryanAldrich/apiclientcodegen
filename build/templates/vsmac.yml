jobs:

- job: VsMacJob
  displayName: 'Build VS Mac Extension'
  pool:
    vmImage: 'macOS-10.15'

  steps:
  
  - bash: |
      cd $(system.defaultworkingdirectory)/src
      sed -i -e 's/1.0/$(build.buildnumber)/g' ApiClientCodeGen.VSMac/Properties/AddinInfo.cs
      make package
      mv ApiClientCodeGen.VSMac.ApiClientCodeGenerator_$(build.buildnumber).mpack ApiClientCodeGenerator-$(build.buildnumber).mpack
      make publish
    displayName: 'Build .mpack file'

  - task: CopyFiles@2
    displayName: 'Copy Files to: $(build.artifactstagingdirectory)'
    inputs:
      sourceFolder: '$(system.defaultworkingdirectory)/src'
      contents: |
        *.mpack
        *.mrep
        index.html
      targetFolder: '$(build.artifactstagingdirectory)'
      flattenFolders: true

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'
    inputs:
      PathtoPublish: '$(build.artifactstagingdirectory)'
